<%- include('../includes/head.ejs') %>
</head>

<body>
    <%- include('../includes/navigation.ejs') %>
    <!-- Page Wrapper -->
    <div style="background: url(/images/bgimg.jpg)" class="page-holder bg-cover">

        <!-- HEADER START -->
        <div class="container py-5">
            <header class="text-center text-white">
                <h1 class="display-4 font-weight-bold mb-4 page-titles">Admin Home</h1>
            </header>
            <!-- HEADER END -->

            <!-- MAIN CONTENT START -->
            <main div class="text-white vh-auto background-transparency">
                <% if (errorMessage) { %>
                <div class="lead text-center pb-3">
                    <p class="notice-text-fail"><%= errorMessage%></p>
                </div>
                <% } %>
                <% if (successMessage) { %>
                <div class="lead text-center pb-3">
                    <p class="notice-text-success"><%= successMessage%></p>
                </div>
                <% } %>

                <!-- Welcome and settings row -->
                <div class="row staff-transparency">
                    <div class="col-10">
                        <h3>Welcome back, <%= user.first_name %>.</h3>
                        <p class="lead pb-0 inline-para">Logged in on:
                            <p class="inline-para">
                                <span id="timestamp"></span>
                            </p>
                        </p>
                    </div>
                </div>

                <div class="container-fluid">
                    <div class="row pt-3">
                        <div class="col-12">
                            <% if (isAdmin) { %>
                            <!-- Business Users -->
                            <h3>Business Users</h3>
                            <table class="table table-hover bg-light">
                                <thead>
                                    <tr class="text-center">
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Phone Number</th>
                                        <th scope="col">Date of Birth</th>
                                        <th scope="col">Organisation Name</th>
                                        <th scope="col">Delete</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for(var i=0; i < allBusinessUsers.length; i++) {  %>
                                    <tr class="text-center">
                                        <th><%= allBusinessUsers[i].first_name%></th>
                                        <td><%= allBusinessUsers[i].last_name%></td>
                                        <td><%= allBusinessUsers[i].email%></td>
                                        <td><%= allBusinessUsers[i].phone_number%></td>
                                        <td><%= allBusinessUsers[i].date_of_birth%></td>
                                        <td><%= allBusinessUsers[i].organisation_name%></td>
                                        <td><a href="/admin-delete-user/<%= allBusinessUsers[i]._id%>">DELETE</a>
                                        </td>
                                    </tr>
                                    <% }  %>
                                </tbody>
                            </table>
                            <!-- Regular Users -->
                            <h3>Regular Users</h3>
                            <table class="table table-hover bg-light">
                                <thead>
                                    <tr class="text-center">
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Phone Number</th>
                                        <th scope="col">Date of Birth</th>
                                        <th scope="col">Delete</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for(var i=0; i < allRegularUsers.length; i++) {  %>
                                    <tr class="text-center">
                                        <th><%= allRegularUsers[i].first_name%></th>
                                        <td><%= allRegularUsers[i].last_name%></td>
                                        <td><%= allRegularUsers[i].email%></td>
                                        <td><%= allRegularUsers[i].phone_number%></td>
                                        <td><%= allRegularUsers[i].date_of_birth%></td>
                                        <td><a href="/admin-delete-user/<%= allRegularUsers[i]._id%>">DELETE</a>
                                        </td>
                                    </tr>
                                    <% }  %>
                                </tbody>
                            </table>
                            <% } %>
                            <% if (!isAdmin) { %>
                                <div class="lead text-center pb-3">
                                    <h3>You are not an admin!</h3>
                                </div>
                                <% } %>
                        </div>
                    </div>
                </div>
        </div>
        </main>
        <!-- MAIN CONTENT END -->
        <%- include('../includes/end.ejs') %>
    </div>
</body>
<script>
    /* 
     * DO NOT REMOVE: 
     * only works if script is at bottom of page
     */
    getDate();
</script>